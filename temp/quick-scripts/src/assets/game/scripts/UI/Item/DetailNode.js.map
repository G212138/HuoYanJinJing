{"version":3,"sources":["assets\\game\\scripts\\UI\\Item\\DetailNode.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { ListenerManager } from \"../../../../frame/scripts/Manager/ListenerManager\";\r\nimport { HitTest } from \"../../../../frame/scripts/Utils/HitTest\";\r\nimport { UIHelp } from \"../../../../frame/scripts/Utils/UIHelp\";\r\nimport { EventType } from \"../../Data/EventType\";\r\nimport TempItem from \"./TempItem\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class DetailNode extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    private itemNode: cc.Node = null;\r\n    @property(cc.Node)\r\n    private leftLayoutNode: cc.Node = null;\r\n    @property(cc.Node)\r\n    private rightLayoutNode: cc.Node = null;\r\n    @property(cc.Node)\r\n    private rightNode: cc.Node = null;\r\n    @property(cc.Node)\r\n    private rightItemNode: cc.Node = null;\r\n\r\n    private _tempData = null;\r\n\r\n    public initData(data) {\r\n        this._tempData = JSON.parse(JSON.stringify(data));\r\n\r\n        this.setLayout();\r\n        this.setRightNode();\r\n    }\r\n\r\n    private setLayout() {\r\n        this.leftLayoutNode.removeAllChildren();\r\n        this.rightLayoutNode.removeAllChildren();\r\n        for (let i = 0; i < this._tempData.leftData.length; i++) {\r\n            let item = cc.instantiate(this.itemNode)\r\n            item.parent = this.leftLayoutNode;\r\n            item.x = 0;\r\n            item.active = true;\r\n            item.getComponent(TempItem).initItem(i, this._tempData.leftData[i])\r\n        }\r\n\r\n        for (let i = 0; i < this._tempData.rightData.length; i++) {\r\n            let item = cc.instantiate(this.itemNode)\r\n            item.parent = this.rightLayoutNode;\r\n            item.x = 0;\r\n            item.active = true;\r\n            item.getComponent(TempItem).initItem(i, this._tempData.rightData[i])\r\n\r\n        }\r\n    }\r\n\r\n    private setRightNode() {\r\n        this.rightNode.removeAllChildren();\r\n        this.rightNode.getComponent(cc.Layout).enabled = true;\r\n        for (let i = 0; i < 30; i++) {\r\n            let item = cc.instantiate(this.rightItemNode)\r\n            item.parent = this.rightNode;\r\n            item.name = i.toString();\r\n            let spriteNode = item.children[0].getComponent(cc.Sprite);\r\n            cc.resources.load(\"images/\" + i, cc.SpriteFrame, function (err, img) {\r\n                spriteNode.spriteFrame = img;\r\n                let width = img.getRect().width;\r\n                let height = img.getRect().height;\r\n                let scale = Math.min(100 / width, 100 / height);\r\n                scale = scale > 1 ? 1 : scale;\r\n                spriteNode.node.scale = scale;\r\n            }.bind(this));\r\n        }\r\n\r\n        this.rightNode.getComponent(cc.Layout).updateLayout();\r\n        this.rightNode.getComponent(cc.Layout).enabled = false;\r\n    }\r\n\r\n    private getHitNodeIndex(nodePos: cc.Vec2): number {\r\n        let index = null;\r\n        for (let i = 0; i < this.rightNode.children.length; i++) {\r\n            if (HitTest.posInRect(nodePos, this.rightNode.children[i])) {\r\n                index = Number(this.rightNode.children[i].name);\r\n                break;\r\n            }\r\n        }\r\n        return index;\r\n    }\r\n\r\n    private isStartInRect = null;\r\n    private curDragNode = null;\r\n    private onDragStart(data: any) {\r\n        this.isStartInRect = this.getHitNodeIndex(cc.v2(data.pos.x, data.pos.y));\r\n        console.log(\"==============\", this.isStartInRect);\r\n        if (this.isStartInRect != null) {\r\n            let node = this.rightNode.getChildByName(this.isStartInRect.toString());\r\n            this.curDragNode = cc.instantiate(node);\r\n            this.curDragNode.active = true\r\n            this.curDragNode.parent = node.parent;\r\n            this.curDragNode.zIndex = 10;\r\n            this.curDragNode.position = node.parent.convertToNodeSpaceAR(cc.v2(data.pos.x, data.pos.y));\r\n        }\r\n    }\r\n\r\n    private onDragMove(data: any) {\r\n        if (this.isStartInRect == null || this.curDragNode == null) {\r\n            return;\r\n        }\r\n        this.curDragNode.position = this.curDragNode.parent.convertToNodeSpaceAR(cc.v2(data.pos.x, data.pos.y));\r\n    }\r\n\r\n    private onDragEnd(data: any) {\r\n        if (data.isClick || this.isStartInRect == null) {\r\n            return;\r\n        }\r\n\r\n        let nodePos = cc.v2(data.pos.x, data.pos.y);\r\n        for (let i = 0; i < this.leftLayoutNode.children.length; i++) {\r\n            const node = this.leftLayoutNode.children[i].getChildByName(\"itemNode\");\r\n            if (HitTest.posInRect(nodePos, node)) {\r\n                this._tempData.leftData[i].spIndex = this.isStartInRect;\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < this.rightLayoutNode.children.length; i++) {\r\n            const node = this.rightLayoutNode.children[i].getChildByName(\"itemNode\");\r\n            if (HitTest.posInRect(nodePos, node)) {\r\n                this._tempData.rightData[i].spIndex = this.isStartInRect;\r\n                break;\r\n            }\r\n        }\r\n\r\n        this.setLayout();\r\n        this.curDragNode.destroy();\r\n        this.curDragNode = null;\r\n        this.isStartInRect = null;\r\n    }\r\n\r\n\r\n    private clickTuiChu() {\r\n        this.node.active = false;\r\n    }\r\n\r\n    private clickBaoCun() {\r\n        this.node.active = false;\r\n        ListenerManager.dispatch(EventType.clickSave, this._tempData);\r\n    }\r\n\r\n}\r\n"]}